// Generated by CoffeeScript 1.4.0
(function() {
  var defaultTemplatedir, documentFile, fs, jade, parse, path, renderFileTree, writeOutput;

  jade = require('jade');

  fs = require('fs');

  path = require('path');

  parse = require('./parser');

  defaultTemplatedir = path.join(path.dirname(fs.realpathSync(__filename)), '../output/html/templates');

  documentFile = function(stylusFile, outputDir, templateDir) {
    var tree;
    if (outputDir == null) {
      outputDir = null;
    }
    if (templateDir == null) {
      templateDir = null;
    }
    if (!(outputDir != null)) {
      outputDir = process.cwd();
    }
    if (!(templateDir != null)) {
      templateDir = defaultTemplatedir;
    }
    if (!fs.existsSync(stylusFile)) {
      error("\"" + stylusFile + "\" does not exist");
    }
    tree = parse(stylusFile);
    return renderFileTree(stylusFile, tree, templateDir, outputDir);
  };

  renderFileTree = function(fileName, tree, templateDir, outputDir) {
    var options, template;
    template = templateDir + '/file.jade';
    options = {
      fileName: fileName,
      tree: tree,
      pretty: true
    };
    return jade.renderFile(template, options, function(err, str) {
      if (err != null) {
        process.exit(1);
      }
      return writeOutput(str, outputDir, fileName);
    });
  };

  writeOutput = function(html, outputDir, stylusFile) {
    var outFile;
    outFile = outputDir + '/' + (path.basename(stylusFile)) + '.html';
    console.log(outFile);
    return fs.writeFileSync(outFile, html);
  };

  module.exports = {
    documentFile: documentFile
  };

}).call(this);
